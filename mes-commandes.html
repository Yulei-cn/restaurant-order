<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mes commandes / æˆ‘çš„è®¢å•</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: auto;
      padding: 20px;
    }

    h2 {
      margin-top: 30px;
    }

    input, button {
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 10px;
      font-size: 16px;
    }

    button.lang-btn {
      display: inline-block;
      width: auto;
      margin-right: 10px;
    }

    ul {
      padding-left: 20px;
    }

    @media (max-width: 600px) {
      h2 {
        font-size: 20px;
      }

      input, button {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <!-- è¯­è¨€åˆ‡æ¢æŒ‰é’® -->
  <div>
    <button class="lang-btn" onclick="setLang('fr')">ğŸ‡«ğŸ‡· FranÃ§ais</button>
    <button class="lang-btn" onclick="setLang('zh')">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</button>
  </div>

  <!-- æ³¨å†Œ / ç™»å½• -->
  <h2 data-i18n="auth_title">Connexion / Inscription</h2>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Mot de passe">
  <button onclick="signup()" data-i18n="signup_btn">S'inscrire</button>
  <button onclick="login()" data-i18n="login_btn">Se connecter</button>
  <button onclick="logout()" data-i18n="logout_btn">Se dÃ©connecter</button>

  <!-- ä¸‹å• -->
  <h2 data-i18n="order_title">Passer une commande</h2>
  <input type="text" id="address" placeholder="Adresse de livraison">
  <input type="text" id="phone" placeholder="NumÃ©ro de tÃ©lÃ©phone">
  <button onclick="submitOrder()" data-i18n="submit_order_btn">Commander</button>

  <!-- è®¢å•å†å² -->
  <h2 data-i18n="history_title">Mes commandes</h2>
  <button onclick="fetchOrders()" data-i18n="refresh_btn">Actualiser</button>
  <ul id="orderList"></ul>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    const SUPABASE_URL = "https://fdbcypvxuikhmxvyyvmb.supabase.co";
    const API_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...";
    const supabase = supabase.createClient(SUPABASE_URL, API_KEY);

    async function signup() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      const { error } = await supabase.auth.signUp({ email, password });
      alert(error ? getText("signup_fail") + error.message : getText("signup_success"));
    }

    async function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      const { error } = await supabase.auth.signInWithPassword({ email, password });
      alert(error ? getText("login_fail") + error.message : getText("login_success"));
    }

    async function logout() {
      await supabase.auth.signOut();
      alert(getText("logout_success"));
    }

    async function submitOrder() {
      const { data: { user }, error: userError } = await supabase.auth.getUser();
      if (userError || !user) return alert(getText("must_login"));

      const address = document.getElementById("address").value;
      const phone = document.getElementById("phone").value;
      const { error } = await supabase.from("orders").insert({
        address, phone, user_id: user.id, created_at: new Date().toISOString()
      });
      alert(error ? getText("order_fail") + error.message : getText("order_success"));
    }

    async function fetchOrders() {
      const { data: { user }, error: userError } = await supabase.auth.getUser();
      if (userError || !user) return alert(getText("must_login"));

      const { data: orders, error } = await supabase
        .from("orders")
        .select("*")
        .eq("user_id", user.id)
        .order("created_at", { ascending: false });

      if (error) return alert(getText("fetch_fail") + error.message);

      const list = document.getElementById("orderList");
      list.innerHTML = "";
      orders.forEach(o => {
        const li = document.createElement("li");
        li.textContent = `${getText("order_line")}${o.address}, ${o.phone}, ${new Date(o.created_at).toLocaleString()}`;
        list.appendChild(li);
      });
    }

    const i18n = {
      fr: {
        auth_title: "Connexion / Inscription",
        signup_btn: "S'inscrire",
        login_btn: "Se connecter",
        logout_btn: "Se dÃ©connecter",
        order_title: "Passer une commande",
        submit_order_btn: "Commander",
        history_title: "Mes commandes",
        refresh_btn: "Actualiser",
        signup_fail: "Ã‰chec de l'inscription : ",
        signup_success: "Inscription rÃ©ussie. VÃ©rifiez votre email.",
        login_fail: "Ã‰chec de la connexion : ",
        login_success: "Connexion rÃ©ussie.",
        logout_success: "DÃ©connexion rÃ©ussie.",
        must_login: "Veuillez d'abord vous connecter.",
        order_fail: "Ã‰chec de la commande : ",
        order_success: "Commande rÃ©ussie !",
        fetch_fail: "Erreur de chargement : ",
        order_line: "Commande : "
      },
      zh: {
        auth_title: "æ³¨å†Œ / ç™»å½•",
        signup_btn: "æ³¨å†Œ",
        login_btn: "ç™»å½•",
        logout_btn: "é€€å‡ºç™»å½•",
        order_title: "æäº¤è®¢å•",
        submit_order_btn: "æäº¤",
        history_title: "æˆ‘çš„è®¢å•",
        refresh_btn: "åˆ·æ–°",
        signup_fail: "æ³¨å†Œå¤±è´¥ï¼š",
        signup_success: "æ³¨å†ŒæˆåŠŸï¼Œè¯·æ£€æŸ¥é‚®ç®±éªŒè¯ã€‚",
        login_fail: "ç™»å½•å¤±è´¥ï¼š",
        login_success: "ç™»å½•æˆåŠŸã€‚",
        logout_success: "å·²é€€å‡ºç™»å½•ã€‚",
        must_login: "è¯·å…ˆç™»å½•ã€‚",
        order_fail: "æäº¤å¤±è´¥ï¼š",
        order_success: "è®¢å•æäº¤æˆåŠŸï¼",
        fetch_fail: "è·å–å¤±è´¥ï¼š",
        order_line: "è®¢å•ï¼š"
      }
    };

    let currentLang = "fr";

    function setLang(lang) {
      currentLang = lang;
      document.querySelectorAll("[data-i18n]").forEach(el => {
        const key = el.getAttribute("data-i18n");
        if (i18n[lang][key]) {
          el.textContent = i18n[lang][key];
        }
      });
    }

    function getText(key) {
      return i18n[currentLang][key] || key;
    }

    // åˆå§‹åŒ–é»˜è®¤è¯­è¨€
    window.onload = () => setLang("fr");
  </script>
</body>
</html>
