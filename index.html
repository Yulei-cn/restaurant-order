<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CUBE - Commande</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 900px; margin: auto; padding: 20px; }
    h1 { text-align: center; }
    .lang-switch { text-align: center; margin-bottom: 20px; }
    .lang-switch button {
      font-size: 20px; padding: 8px 16px; margin: 0 5px;
      background-color: #aed581; border: none; border-radius: 6px; cursor: pointer;
    }
    .item-row {
      display: flex; justify-content: space-between; align-items: center;
      border-bottom: 1px solid #ddd; padding: 10px 0;
    }
    .item-name { flex: 1; }
    .item-controls {
      display: flex; align-items: center; gap: 10px;
    }
    .item-controls button {
      padding: 4px 10px; font-size: 16px; cursor: pointer;
    }
    .total-price {
      text-align: right; font-size: 1.4em; margin-top: 20px; font-weight: bold;
    }
    label { display: block; margin-top: 15px; }
    input[type="text"], input[type="tel"] {
      width: 100%; padding: 8px; margin-top: 5px;
    }
    #submitBtn {
      margin-top: 20px; font-size: 18px; padding: 10px 20px;
      background: #81c784; border: none; border-radius: 6px; cursor: pointer;
    }
  </style>
</head>
<body>

<div class="lang-switch">
  <button onclick="setLang('fr')">ğŸ‡«ğŸ‡· FranÃ§ais</button>
  <button onclick="setLang('zh')">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</button>
</div>

<h1 id="title">ğŸ¥¡ CUBE - Commande</h1>
<div id="infoBox">ğŸ“ 7 Rue Blanche, 75009 Paris â€” â° 11:30â€“20:30</div>

<form id="orderForm">
  <h2>ğŸ± <span data-fr="Composez votre repas" data-zh="é€‰æ‹©ä½ çš„é¤å“">Composez votre repas</span></h2>
  <div id="menuItems"></div>
  <div class="total-price">ğŸ’° Total : <span id="total">0.00</span> â‚¬</div>

  <h2 data-fr="Informations de livraison" data-zh="é€é¤ä¿¡æ¯">Informations de livraison</h2>

  <label data-fr="Adresse (optionnel)" data-zh="åœ°å€ï¼ˆå¯é€‰ï¼‰">
    <input type="text" name="address" id="address" placeholder="22 Rue Truc, 75010 Paris">
  </label>
  <label data-fr="TÃ©lÃ©phone" data-zh="ç”µè¯">
    <input type="tel" name="phone" id="phone" required placeholder="06 12 34 56 78">
  </label>
  <label data-fr="Remarques (optionnel)" data-zh="å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰">
    <input type="text" name="notes" id="notes" placeholder="Pas Ã©picÃ©, sans oignons...">
  </label>
  <button type="submit" id="submitBtn">âœ… Commander</button>
</form>

<p id="result"></p>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.5/dist/umd/supabase.min.js"></script>
<script>
const SUPABASE_URL = "https://fdbcypvxuikhmxvyyvmb.supabase.co";
const API_KEY = "ä½ çš„API_KEY";
const client = window.supabase.createClient(SUPABASE_URL, API_KEY);

const menuData = [
  // ä¸»é£Ÿ
  { name: "Riz nature", price: 2.5 },
  { name: "Riz sautÃ©", price: 5.8 },
  { name: "Nouilles sautÃ©es", price: 6.8 },
  // çƒ­èœ
  { name: "BÅ“uf mijotÃ©", price: 8.8 },
  { name: "Porc braisÃ©", price: 8.8 },
  { name: "Poulet aigre-doux", price: 8.8 },
  { name: "Porc sautÃ© croustillant", price: 8.8 },
  { name: "Poulet frit", price: 8.8 },
  { name: "Porc frit croustillant", price: 8.8 },
  { name: "Poulet Kung Pao", price: 8.8 },
  { name: "Aubergines braisÃ©es", price: 6.8 },
  { name: "Haricots verts sautÃ©s", price: 6.8 },
  { name: "Å’ufs aux tomates", price: 6.8 },
  // å‰èœ
  { name: "Concombre marinÃ©", price: 5.8 },
  { name: "Radis aigre-doux", price: 5.8 },
  { name: "Pommes de terre rÃ¢pÃ©es", price: 5.8 },
  { name: "Algues marinÃ©es", price: 5.8 },
  // å°åƒ
  { name: "Roujiamo porc", price: 5.8 },
  { name: "Roujiamo bÅ“uf", price: 6.8 },
  // é¥®å“
  { name: "Coca-Cola", price: 2.0 },
  { name: "Sprite", price: 2.0 },
  { name: "Fanta", price: 2.0 },
  { name: "ThÃ© Ã  la pÃªche", price: 2.0 },
  { name: "Jus dâ€™orange", price: 2.0 },
  { name: "Eau minÃ©rale", price: 2.0 },
  // å¥—é¤
  { name: "Formule 1", price: 11.8 },
  { name: "Formule 2", price: 13.8 }
];

let cart = {};
function renderMenu() {
  const container = document.getElementById("menuItems");
  container.innerHTML = "";
  menuData.forEach(item => {
    const qty = cart[item.name] || 0;
    container.innerHTML += `
      <div class="item-row">
        <div class="item-name">${item.name} - ${item.price.toFixed(2)}â‚¬</div>
        <div class="item-controls">
          <button type="button" onclick="changeQty('${item.name}', -1)">â–</button>
          <span id="qty-${item.name}">${qty}</span>
          <button type="button" onclick="changeQty('${item.name}', 1)">â•</button>
        </div>
      </div>`;
  });
  updateTotal();
}
function changeQty(name, delta) {
  cart[name] = Math.max(0, (cart[name] || 0) + delta);
  document.getElementById(`qty-${name}`).textContent = cart[name];
  updateTotal();
}
function updateTotal() {
  let total = 0;
  for (const [name, qty] of Object.entries(cart)) {
    const item = menuData.find(i => i.name === name);
    if (item) total += item.price * qty;
  }
  document.getElementById("total").textContent = total.toFixed(2);
}
window.onload = renderMenu;

<script>
document.getElementById("orderForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const items = [];
  for (const [name, qty] of Object.entries(cart)) {
    if (qty > 0) {
      const item = menuData.find(i => i.name === name);
      items.push({ name, qty, price: item.price });
    }
  }

  if (items.length === 0) {
    document.getElementById("result").textContent = "âš ï¸ Veuillez choisir au moins un produit / è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªèœå“";
    return;
  }

  const address = document.getElementById("address").value || "";
  const phone = document.getElementById("phone").value || "";
  const notes = document.getElementById("notes").value || "";

  const {
    data: { user },
    error
  } = await client.auth.getUser();

  if (!user || error) {
    alert("Veuillez vous connecter d'abord / è¯·å…ˆç™»å½•");
    return;
  }

  const res = await fetch(`${SUPABASE_URL}/rest/v1/orders`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      apikey: API_KEY,
      Authorization: `Bearer ${API_KEY}`,
      Prefer: "return=minimal"
    },
    body: JSON.stringify({
      user_id: user.id,
      status: "æ–°è®¢å•",
      items,
      address,
      phone,
      notes
    })
  });

  if (res.ok) {
    cart = {};
    renderMenu();
    document.getElementById("orderForm").reset();
    updateTotal();
    document.getElementById("result").textContent = "âœ… Commande envoyÃ©e avec succÃ¨s ! / è®¢å•æäº¤æˆåŠŸ";
  } else {
    document.getElementById("result").textContent = "âŒ Ã‰chec de la commande / ä¸‹å•å¤±è´¥";
  }
});
</script>

function setLang(lang) {
  document.documentElement.lang = lang;
  document.getElementById("title").textContent =
    lang === "zh" ? "ğŸ¥¡ CUBEç›’é¥­ç‚¹é¤" : "ğŸ¥¡ CUBE - Commande";
  document.getElementById("submitBtn").textContent =
    lang === "zh" ? "âœ… æäº¤è®¢å•" : "âœ… Commander";
  document.getElementById("infoBox").textContent =
    lang === "zh" ? "ğŸ“ å·´é»9åŒº Rue Blanche 7å· â€” â° è¥ä¸šæ—¶é—´ 11:30â€“20:30"
                  : "ğŸ“ 7 Rue Blanche, 75009 Paris â€” â° 11:30â€“20:30";
  document.querySelectorAll("[data-fr]").forEach(el => {
    el.textContent = lang === "zh" ? el.dataset.zh : el.dataset.fr;
  });
}
</script>

<!-- ğŸ“ åœ°å›¾ -->
<footer style="margin-top: 40px;">
  <h2 style="text-align:center; font-size: 18px;">ğŸ“ Nous trouver</h2>
  <div style="margin-top: 10px;">
    <iframe
      src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d8825.590530254658!2d2.3290846801073477!3d48.87987362995386!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x47e66e49cbdef35d%3A0xb63d7e4ddc4223c7!2sHano%C3%AF%20Corner!5e0!3m2!1szh-CN!2sfr!4v1745323929492!5m2!1szh-CN!2sfr"
      width="100%" height="300" style="border:0; border-radius: 8px;" allowfullscreen="" loading="lazy">
    </iframe>
  </div>
</footer>

</body>
</html>
