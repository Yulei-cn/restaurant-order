<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CUBE - Commande</title>
  <style>
    body { font-family: Arial; max-width: 900px; margin: auto; padding: 20px; }
    h1 { text-align: center; }
    h2 { margin-top: 30px; border-bottom: 1px solid #ccc; padding-bottom: 5px; }
    .lang-switch { text-align: center; margin-bottom: 20px; }
    .lang-switch button {
      font-size: 20px; padding: 8px 16px; margin: 0 5px;
      background-color: #aed581; border: none; border-radius: 6px; cursor: pointer;
    }
    table {
      width: 100%; border-collapse: collapse; margin-top: 10px;
    }
    table th, table td {
      border: 1px solid #ccc; padding: 8px; text-align: left;
    }
    table th { background-color: #f1f8e9; }
    .total-price {
      text-align: right; font-size: 1.4em; margin-top: 20px; font-weight: bold;
    }
    label { display: block; margin-top: 15px; }
    input[type="text"], input[type="tel"] {
      width: 100%; padding: 8px; margin-top: 5px;
    }
    #submitBtn {
      margin-top: 20px; font-size: 18px; padding: 10px 20px;
      background: #81c784; border: none; border-radius: 6px; cursor: pointer;
    }
  </style>
</head>
<body>

<div class="lang-switch">
  <button onclick="setLang('fr')">🇫🇷 Français</button>
  <button onclick="setLang('zh')">🇨🇳 中文</button>
</div>

<h1 id="title">🥡 CUBE - Commande</h1>
<div id="infoBox">📍 7 Rue Blanche, 75009 Paris — ⏰ 11:30–20:30</div>

<form id="orderForm">
  <h2>🥗 Entrées / 前菜</h2>
  <div class="table-container">
    <table>
      <tr><th>Nom</th><th>Prix</th></tr>
      <tr><td>Concombre mariné / 拍黄瓜</td><td>5,80 €</td></tr>
      <tr><td>Radis aigre-doux / 酸甜萝卜</td><td>5,80 €</td></tr>
      <tr><td>Pommes de terre râpées / 凉拌土豆丝</td><td>5,80 €</td></tr>
      <tr><td>Algues marinées / 海带丝</td><td>5,80 €</td></tr>
    </table>
  </div>

  <h2>🍛 Plats chauds / 热菜</h2>
  <div class="table-container">
    <table>
      <tr><th>Nom</th><th>Prix</th></tr>
      <tr><td>Bœuf mijoté / 烧牛肉</td><td>8,80 €</td></tr>
      <tr><td>Porc braisé / 红烧肉</td><td>8,80 €</td></tr>
      <tr><td>Poulet aigre-doux / 糖醋鸡</td><td>8,80 €</td></tr>
      <tr><td>Porc sauté croustillant / 溜肉段</td><td>8,80 €</td></tr>
      <tr><td>Poulet frit / 炸鸡块</td><td>8,80 €</td></tr>
      <tr><td>Porc frit croustillant / 小酥肉</td><td>8,80 €</td></tr>
      <tr><td>Poulet Kung Pao / 宫保鸡丁</td><td>8,80 €</td></tr>
      <tr><td>Aubergines braisées / 烧茄子</td><td>6,80 €</td></tr>
      <tr><td>Haricots verts sautés / 干煸豆角</td><td>6,80 €</td></tr>
      <tr><td>Œufs aux tomates / 番茄炒鸡蛋</td><td>6,80 €</td></tr>
    </table>
  </div>

  <h2>🍚 Accompagnements / 主食</h2>
  <div class="table-container">
    <table>
      <tr><th>Nom</th><th>Prix</th></tr>
      <tr><td>Riz nature / 米饭</td><td>2,50 €</td></tr>
      <tr><td>Riz sauté / 炒饭</td><td>5,80 €</td></tr>
      <tr><td>Nouilles sautées / 炒面</td><td>6,80 €</td></tr>
    </table>
  </div>

  <h2>🥯 Snacks / 小吃</h2>
  <div class="table-container">
    <table>
      <tr><th>Nom</th><th>Prix</th></tr>
      <tr><td>Roujiamo porc / 猪肉肉夹馍</td><td>5,80 €</td></tr>
      <tr><td>Roujiamo bœuf / 牛肉肉夹馍</td><td>6,80 €</td></tr>
    </table>
  </div>

  <h2>🥤 Boissons / 饮品</h2>
  <div class="table-container">
    <table>
      <tr><th>Nom</th><th>Prix</th></tr>
      <tr><td>Coca-Cola / 可乐</td><td>2,00 €</td></tr>
      <tr><td>Sprite / 雪碧</td><td>2,00 €</td></tr>
      <tr><td>Fanta / 芬达</td><td>2,00 €</td></tr>
      <tr><td>Thé à la pêche / 桃茶</td><td>2,00 €</td></tr>
      <tr><td>Jus d’orange / 橙汁</td><td>2,00 €</td></tr>
      <tr><td>Eau minérale / 矿泉水</td><td>2,00 €</td></tr>
    </table>
  </div>

  <h2>🍱 Formules / 套餐</h2>
  <div class="table-container">
    <table>
      <tr><th>Nom</th><th>Action</th></tr>
      <tr><td>Formule 1 — 11,80 €<br>米饭或炒面（+1€）+ 前菜1 + 热菜2 + 饮品（+1€）</td>
          <td><button type="button" onclick="openFormule('Formule 1', 11.8, 2)">🛒 Choisir</button></td></tr>
      <tr><td>Formule 2 — 13,80 €<br>米饭或炒面（+1€）+ 前菜1 + 热菜3 + 饮品（+1€）</td>
          <td><button type="button" onclick="openFormule('Formule 2', 13.8, 3)">🛒 Choisir</button></td></tr>
    </table>
  </div>
  <div class="total-price">💰 Total : <span id="total">0.00</span> €</div>

  <h2 data-fr="Informations de retrait (optionnel)" data-zh="备注信息（可选）">Informations de retrait</h2>
  <label data-fr="Adresse (optionnel)" data-zh="地址（可选）">
    <input type="text" name="address" id="address" />
  </label>
  <label data-fr="Téléphone (optionnel)" data-zh="电话（可选）">
    <input type="tel" name="phone" id="phone" />
  </label>
  <label data-fr="Remarques (optionnel)" data-zh="备注（可选）">
    <input type="text" name="notes" id="notes" />
  </label>

  <button type="submit" id="submitBtn">✅ Commander</button>
</form>

<p id="result"></p>

<script>
let cart = {};

function openFormule(label, basePrice, heatCount) {
  const base = prompt("主食？(Riz / Nouilles)", "Riz") || "Riz";
  const entree = prompt("前菜？", "Concombre mariné") || "Concombre mariné";
  const heats = [];
  for (let i = 1; i <= heatCount; i++) {
    heats.push(prompt(`热菜 ${i}？`, "Poulet frit") || "Poulet frit");
  }
  const drink = prompt("是否加饮品？(留空为不加)", "") || "";
  const extra = (base.toLowerCase() === "nouilles" ? 1 : 0) + (drink ? 1 : 0);
  const name = `${label}: ${base} + ${entree} + ${heats.join(" + ")}${drink ? " + " + drink : ""}`;
  const fullPrice = basePrice + extra;
  cart[name] = (cart[name] || 0) + 1;
  document.getElementById("menuItems")?.insertAdjacentHTML('beforeend',
    `<div class="item-row"><div class="item-name">${name} - ${fullPrice.toFixed(2)}€</div><div class="item-controls">
      <button onclick="changeQty('${name}', -1)">➖</button>
      <span id="qty-${name}">${cart[name]}</span>
      <button onclick="changeQty('${name}', 1)">➕</button></div></div>`);
  updateTotal();
}

function changeQty(name, delta) {
  cart[name] = Math.max(0, (cart[name] || 0) + delta);
  document.getElementById(`qty-${name}`)?.textContent = cart[name];
  updateTotal();
}

function updateTotal() {
  let total = 0;
  for (const [name, qty] of Object.entries(cart)) {
    const price = parseFloat(name.match(/- ([\d.]+)€/)?.[1] || 0);
    total += price * qty;
  }
  document.getElementById("total").textContent = total.toFixed(2);
}

// 表单提交
document.getElementById("orderForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const items = [];
  for (const [name, qty] of Object.entries(cart)) {
    if (qty > 0) {
      const price = parseFloat(name.match(/- ([\d.]+)€/)?.[1] || 0);
      items.push({ name, qty, price });
    }
  }
  if (items.length === 0) {
    document.getElementById("result").textContent = "⚠️ Veuillez choisir un produit.";
    return;
  }

  const address = document.getElementById("address").value || "";
  const phone = document.getElementById("phone").value || "";
  const notes = document.getElementById("notes").value || "";

  const res = await fetch("https://fdbcypvxuikhmxvyyvmb.supabase.co/rest/v1/orders", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      apikey: "你的完整API_KEY",
      Authorization: `Bearer ${"你的完整API_KEY"}`,
      Prefer: "return=minimal"
    },
    body: JSON.stringify({
      user_id: null,
      status: "新订单",
      items,
      address,
      phone,
      notes
    })
  });

  if (res.ok) {
    cart = {};
    document.getElementById("orderForm").reset();
    document.getElementById("menuItems").innerHTML = "";
    updateTotal();
    document.getElementById("result").textContent = "✅ Commande envoyée / 订单已提交";
  } else {
    document.getElementById("result").textContent = "❌ Erreur / 提交失败";
  }
});

// 语言切换
function setLang(lang) {
  document.documentElement.lang = lang;
  document.getElementById("title").textContent = lang === "zh" ? "🥡 CUBE盒饭点餐" : "🥡 CUBE - Commande";
  document.getElementById("submitBtn").textContent = lang === "zh" ? "✅ 提交订单" : "✅ Commander";
  document.getElementById("infoBox").textContent =
    lang === "zh" ? "📍 巴黎9区 Rue Blanche 7号 — ⏰ 营业时间 11:30–20:30"
                  : "📍 7 Rue Blanche, 75009 Paris — ⏰ 11:30–20:30";
  document.querySelectorAll("[data-fr]").forEach(el => {
    el.textContent = lang === "zh" ? el.dataset.zh : el.dataset.fr;
  });
}
</script>

<!-- 地图 -->
<footer style="margin-top: 40px;">
  <h2 style="text-align:center;">📍 Nous trouver</h2>
  <iframe
    src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d8825.590530254658!2d2.3290846801073477!3d48.87987362995386!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x47e66e49cbdef35d%3A0xb63d7e4ddc4223c7!2sHano%C3%AF%20Corner!5e0!3m2!1szh-CN!2sfr!4v1745323929492!5m2!1szh-CN!2sfr"
    width="100%" height="300" style="border:0; border-radius: 8px;" allowfullscreen="" loading="lazy">
  </iframe>
</footer>

</body>
</html>
